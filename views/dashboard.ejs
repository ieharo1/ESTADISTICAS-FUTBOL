<%- include('partials/header', { title }) %>

<div class="page-header">
  <div class="d-flex flex-column flex-lg-row gap-3 align-items-lg-center justify-content-between">
    <div>
      <h1>Dashboard Principal</h1>
      <p class="mb-0">An√°lisis completo de las principales ligas europeas</p>
    </div>
    <div class="filter-bar p-0 bg-transparent border-0">
      <div class="form-group">
        <label class="form-label">Liga</label>
        <select id="leagueSelect" class="form-select">
          <% leagues.forEach((league) => { %>
          <option value="<%= league %>"><%= league %></option>
          <% }) %>
        </select>
      </div>
    </div>
  </div>
</div>

<section class="row g-3 mb-4" id="overviewCards">
  <div class="col-12 col-md-6 col-xl-3 animate-fade-in stagger-1">
    <div class="metric-card info">
      <div class="metric-icon">‚öΩÔ∏è</div>
      <div class="metric-label">Goles Totales</div>
      <div class="metric-value" id="totalGoals">-</div>
      <div class="metric-subtitle">en la temporada</div>
    </div>
  </div>
  <div class="col-12 col-md-6 col-xl-3 animate-fade-in stagger-2">
    <div class="metric-card success">
      <div class="metric-icon">üìä</div>
      <div class="metric-label">Promedio por Partido</div>
      <div class="metric-value" id="avgGoals">-</div>
      <div class="metric-subtitle">goles por encuentro</div>
    </div>
  </div>
  <div class="col-12 col-md-6 col-xl-3 animate-fade-in stagger-3">
    <div class="metric-card warning">
      <div class="metric-icon">üèÜ</div>
      <div class="metric-label">Mejor Ataque</div>
      <div class="metric-value" id="bestAttack" style="font-size: 1.5rem;">-</div>
      <div class="metric-subtitle">m√°s goles a favor</div>
    </div>
  </div>
  <div class="col-12 col-md-6 col-xl-3 animate-fade-in stagger-4">
    <div class="metric-card">
      <div class="metric-icon">üõ°Ô∏è</div>
      <div class="metric-label">Mejor Defensa</div>
      <div class="metric-value" id="bestDefense" style="font-size: 1.5rem;">-</div>
      <div class="metric-subtitle">menos goles recibidos</div>
    </div>
  </div>
</section>

<section class="row g-3 mb-4">
  <div class="col-12 col-xl-8">
    <div class="card h-100">
      <div class="card-header">
        <h2 class="card-title">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></svg>
          Tabla de Posiciones
        </h2>
        <span class="badge bg-primary bg-opacity-10 text-primary" id="leagueBadge">-</span>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive scrollbar-thin">
          <table class="table table-hover mb-0" id="standingsTable">
            <thead>
              <tr>
                <th>#</th>
                <th>Equipo</th>
                <th>PJ</th>
                <th>G</th>
                <th>E</th>
                <th>P</th>
                <th>GF</th>
                <th>GC</th>
                <th>DG</th>
                <th>Pts</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  <div class="col-12 col-xl-4">
    <div class="card h-100">
      <div class="card-header">
        <h2 class="card-title">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></svg>
          Distribuci√≥n de Puntos
        </h2>
      </div>
      <div class="card-body">
        <div id="pointsPie" class="chart-box"></div>
      </div>
    </div>
  </div>
</section>

<section class="row g-3 mb-4">
  <div class="col-12 col-lg-6">
    <div class="card h-100">
      <div class="card-header">
        <h2 class="card-title">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><line x1="12" y1="20" x2="12" y2="10"/><line x1="18" y1="20" x2="18" y2="4"/><line x1="6" y1="20" x2="6" y2="16"/></svg>
          Goles por Equipo
        </h2>
      </div>
      <div class="card-body">
        <div id="goalsBar" class="chart-box"></div>
      </div>
    </div>
  </div>
  <div class="col-12 col-lg-6">
    <div class="card h-100">
      <div class="card-header">
        <h2 class="card-title">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/></svg>
          Radar de Rendimiento
        </h2>
      </div>
      <div class="card-body">
        <div id="radarChart" class="chart-box"></div>
      </div>
    </div>
  </div>
</section>

<section class="row g-3">
  <div class="col-12 col-lg-6">
    <div class="card">
      <div class="card-header">
        <h2 class="card-title">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
          Evoluci√≥n de Puntos
        </h2>
      </div>
      <div class="card-body">
        <div id="pointsLine" class="chart-box"></div>
      </div>
    </div>
  </div>
  <div class="col-12 col-lg-6">
    <div class="card">
      <div class="card-header">
        <h2 class="card-title">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><rect x="7" y="7" width="3" height="9"/><rect x="14" y="7" width="3" height="5"/></svg>
          Diferencia de Goles
        </h2>
      </div>
      <div class="card-body">
        <div id="goalDiffChart" class="chart-box"></div>
      </div>
    </div>
  </div>
</section>

<script src="/js/dashboard.js"></script>
<script>
  const currentUser = { name: '<%= typeof user !== "undefined" && user ? user.name : "Usuario" %>' };
  if (currentUser.name && currentUser.name !== 'undefined') {
    document.getElementById('userName').textContent = currentUser.name;
  }
</script>
<%- include('partials/footer') %>
